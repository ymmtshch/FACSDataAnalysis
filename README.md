# FACS Data Analysis
StreamlitベースのFACS（フローサイトメトリー）データ解析Webアプリケーション

## 概要
フローサイトメトリーデータ（FCSファイル）を解析するためのWebアプリケーションです。日本語インターフェースで直感的な操作を提供します。

## 主な機能
### アプリケーション構成
- **メインアプリ（app.py）**: 統合解析インターフェース
- **基本解析ページ**: 詳細な解析機能
- **高度ゲーティングページ**: 複雑なゲーティング解析

### データ処理・可視化
- **FCSファイル対応**: FCS 2.0/3.0/3.1形式の読み込み
- **データ変換**: なし、Log10、Asinh変換
- **可視化**: 散布図、密度プロット、ヒストグラム
- **パフォーマンス最適化**: 自動イベント数制御

### ゲーティング機能
- **基本ゲーティング**: 単一チャンネル閾値設定
- **高度ゲーティング**: 矩形・ポリゴン・楕円・閾値ゲート
- **リアルタイム統計**: ゲート効率と統計情報の即時表示

### 統計解析・エクスポート
- **統計情報**: 平均値、中央値、標準偏差、最小値、最大値
- **データエクスポート**: 統計データとraw dataのCSV出力

## インストール
### 必要なライブラリ
```bash
pip install streamlit pandas numpy plotly fcsparser scipy
```

### 実行方法
```bash
git clone https://github.com/ymmtshch/FACSDataAnalysis.git
cd FACSDataAnalysis
pip install -r requirements.txt
streamlit run app.py
```

## プロジェクト構造
```
facs-analysis-app/
├── app.py                    # メインアプリケーション
├── config.py                 # 設定ファイル
├── requirements.txt          # 依存関係
├── pages/
│   ├── basic_analysis.py     # 基本解析ページ
│   └── advanced_gating.py    # 高度ゲーティングページ
└── utils/
    ├── fcs_processor.py      # FCS処理ユーティリティ
    ├── plotting.py           # プロット作成機能
    └── gating.py             # ゲーティング機能
```

## 使用方法
### 1. メインアプリケーション（app.py）
4つのタブで構成：
- **📊 基本情報**: ファイル・実験・チャンネル情報、データプレビュー
- **📈 可視化**: ヒストグラム、散布図、密度プロット
- **🎯 ゲーティング**: 基本閾値ゲーティング機能
- **📋 統計解析**: 統計情報とCSVエクスポート

### 2. 基本解析ページ（pages/basic_analysis.py）
- **詳細メタデータ**: 実験情報とチャンネル詳細
- **個別変換設定**: X軸・Y軸それぞれに異なる変換適用
- **リアルタイム統計**: 選択チャンネルの統計解析
- **自動ファイル命名**: `{元ファイル名}_stats.csv`形式でエクスポート

### 3. 高度ゲーティングページ（pages/advanced_gating.py）
- **多様なゲート**: 矩形・ポリゴン・楕円・閾値ゲート
- **インタラクティブ解析**: 密度プロット上でのリアルタイム表示
- **複数ゲート管理**: 同時設定・削除・統計比較機能

## 対応ファイル形式
- **FCS 2.0/3.0/3.1**: 標準的なフローサイトメトリーファイル
- **最大サイズ**: 100MB
- **チャンネル**: FSC/SSC、各種蛍光チャンネル

## トラブルシューティング
### よくある問題
- **ファイル読み込みエラー**: ファイルサイズ（100MB制限）とFCS形式を確認
- **メモリ不足**: イベント数を自動調整
- **変換エラー**: 変換方法を"なし"に変更してテスト
- **プロット表示**: ブラウザのJavaScript有効化を確認

### デバッグ機能
- サイドバーでデータ形状・変換プロセスの詳細確認
- チャンネル名とメタデータの検証機能
- エラー詳細の展開表示

## 制限事項
- メモリ使用量: 大容量FCSファイルで制限あり
- セッション管理: ブラウザ終了でデータ消失
- 同時ユーザー: Streamlit Cloudでアクセス数制限

## 開発情報
- **言語**: Python 3.8以上
- **フレームワーク**: Streamlit
- **FCS処理**: fcsparserライブラリ
- **可視化**: Plotly

---
**Author**: ymmtshch  
**Repository**: [https://github.com/ymmtshch/FACSDataAnalysis](https://github.com/ymmtshch/FACSDataAnalysis)  
**Version**: 1.0.0
